<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Audio Transcript Gap Filling - Parking Fee Case Study</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.8;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      background-color: #fefefe;
    }
    h2 {
      color: #2a2a2a;
      border-bottom: 2px solid #0078d4;
      padding-bottom: 10px;
    }
    .transcript-container {
      margin-top: 30px;
      background-color: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }
    .gap-input {
      display: inline-block;
      min-width: 80px;
      margin: 0 5px;
      padding: 2px 8px;
      border: 2px solid #ccc;
      border-radius: 4px;
      background-color: white;
      text-align: center;
      font-family: inherit;
      font-size: inherit;
    }
    .gap-input:focus {
      outline: none;
      border-color: #0078d4;
      box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.2);
    }
    .correct {
      border-color: #4CAF50;
      background-color: #f0fff4;
    }
    .incorrect {
      border-color: #f44336;
      background-color: #fff0f0;
    }
    .correct-answer {
      color: #4CAF50;
      font-weight: bold;
    }
    button {
      margin: 15px 10px 15px 0;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
    }
    #checkAnswers {
      background-color: #0078d4;
      color: white;
    }
    #checkAnswers:hover {
      background-color: #005fa3;
    }
    #showAnswers {
      background-color: #4CAF50;
      color: white;
    }
    #showAnswers:hover {
      background-color: #388E3C;
    }
    #resetGaps {
      background-color: #ff9800;
      color: white;
    }
    #resetGaps:hover {
      background-color: #f57c00;
    }
    .instructions {
      background-color: #e8f4fc;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #0078d4;
      font-size: 14px;
    }
    .audio-container {
      margin: 20px 0;
      padding: 15px;
      background-color: #f0f7ff;
      border-radius: 8px;
      border: 1px solid #cce0ff;
    }
    .results {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      background-color: #f8f9fa;
      border: 1px solid #e0e0e0;
      display: none;
    }
    .score {
      font-size: 18px;
      font-weight: bold;
      color: #0078d4;
      margin-bottom: 10px;
    }
    .gap-container {
      position: relative;
      display: inline-block;
      margin: 0 5px;
    }
    .gap-number {
      position: absolute;
      top: -15px;
      left: 0;
      font-size: 11px;
      color: #666;
      font-weight: bold;
      width: 100%;
      text-align: center;
    }
  </style>
</head>
<body>

  <h2>üéß Audio Transcript Gap Filling Practice</h2>
  
  <div class="instructions">
    <p><strong>Instructions:</strong> Listen to the audio, then fill in the blanks with the correct words. Click "Check Answers" to validate your responses. Use "Show Answers" to reveal all correct answers, and "New Gaps" to generate a new set of blanks.</p>
    <p><em>Note: Answers are case-insensitive but must be spelled correctly.</em></p>
  </div>

  <!-- Audio player from SoundCloud -->
  <div class="audio-container">
    <iframe width="100%" height="166" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/soundcloud%253Atracks%253A2251227545&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true"></iframe>
    <div style="font-size: 10px; color: #cccccc;line-break: anywhere;word-break: normal;overflow: hidden;white-space: nowrap;text-overflow: ellipsis; font-family: Interstate,Lucida Grande,Lucida Sans Unicode,Lucida Sans,Garuda,Verdana,Tahoma,sans-serif;font-weight: 100;">
      <a href="https://soundcloud.com/grzegorz-tarnowski-1" title="Grzegorz Tarnowski" target="_blank" style="color: #cccccc; text-decoration: none;">Grzegorz Tarnowski</a> ¬∑ 
      <a href="https://soundcloud.com/grzegorz-tarnowski-1/asw01" title="ASW01" target="_blank" style="color: #cccccc; text-decoration: none;">ASW01</a>
    </div>
  </div>

  <div class="transcript-container">
    <h3>Fill in the Blanks:</h3>
    <div id="transcript"></div>
    
    <div>
      <button id="checkAnswers" onclick="checkAnswers()">‚úì Check Answers</button>
      <button id="showAnswers" onclick="showAllAnswers()">üëÅ Show All Answers</button>
      <button id="resetGaps" onclick="generateGaps()">üîÑ New Gaps</button>
    </div>
    
    <div id="results" class="results">
      <div id="scoreDisplay" class="score"></div>
      <div id="detailedResults"></div>
    </div>
  </div>

  <script>
    const originalText = `
Let me tell you what happened as a result of this increase. Many students who parked their cars on campus found the original $4 per day fee difficult to afford, but they somehow managed to come up with what they considered an exorbitant amount of money to pay the $4 each day. However, when the fee was raised to $8 per day, this amount was entirely too much money for quite a few students to come up with.

For many of them, because they simply could not afford to pay the amount, they looked for ways to get around paying it. Some students, who had been driving alone to school, looked for other students to carpool with so that they could drive to school together and divide the $8 per day fee among two, three, or four riders and, by the way, also save some money on gas at the same time. Other students, who had previously been driving to school alone, began finding other ways to get to school, perhaps by walking, riding bicycles, or taking the bus to school, because these methods of getting to school cost far less than driving to school and paying the exorbitant $8 per day fee.

In the end, the number of students parking cars on campus was reduced by more than half, and the overall amount of money collected from parking fees paid by students was reduced to less than it had been when the parking fee was only $4 per day.
`;

    let currentGaps = [];
    let gapInputs = [];

    function generateGaps() {
      const container = document.getElementById('transcript');
      const paragraphs = originalText.trim().split('\n\n');
      const resultsDiv = document.getElementById('results');
      const scoreDisplay = document.getElementById('scoreDisplay');
      const detailedResults = document.getElementById('detailedResults');
      
      // Reset state
      currentGaps = [];
      gapInputs = [];
      resultsDiv.style.display = 'none';
      scoreDisplay.textContent = '';
      detailedResults.innerHTML = '';
      
      let htmlContent = '';
      let gapCounter = 1;
      
      paragraphs.forEach(paragraph => {
        const words = paragraph.split(' ');
        const numGaps = Math.floor(words.length * 0.3); // 30% gaps
        const gapIndices = new Set();

        // Select random words to be gaps
        while (gapIndices.size < numGaps) {
          const i = Math.floor(Math.random() * words.length);
          const clean = words[i].replace(/[.,!?;:$]/g, '');
          if (!words[i].includes('<') && clean.length > 3 && !/^\d+$/.test(clean)) {
            gapIndices.add(i);
          }
        }

        // Process each word in the paragraph
        const processedWords = words.map((word, i) => {
          const clean = word.replace(/[.,!?;:$]/g, '');
          const punctuation = word.match(/[.,!?;:$]+$/);
          
          if (gapIndices.has(i)) {
            // Store gap information
            currentGaps.push({
              id: gapCounter,
              correctAnswer: clean.toLowerCase(),
              fullWord: word,
              position: gapCounter
            });
            
            const gapHtml = `
              <span class="gap-container">
                <span class="gap-number">${gapCounter}</span>
                <input type="text" 
                       class="gap-input" 
                       id="gap-${gapCounter}" 
                       data-gap-id="${gapCounter}"
                       placeholder="_____"
                       style="width: ${Math.max(80, clean.length * 10)}px">
                ${punctuation ? punctuation[0] : ''}
              </span>
            `;
            gapCounter++;
            return gapHtml;
          }
          return word;
        });

        htmlContent += `<p>${processedWords.join(' ')}</p>`;
      });

      container.innerHTML = htmlContent;
      
      // Store references to all gap inputs
      gapInputs = Array.from(document.querySelectorAll('.gap-input'));
      
      // Add event listeners for Enter key
      gapInputs.forEach(input => {
        input.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            checkAnswers();
          }
        });
      });
    }

    function checkAnswers() {
      let correctCount = 0;
      const results = [];
      
      gapInputs.forEach(input => {
        const gapId = parseInt(input.dataset.gapId);
        const userAnswer = input.value.trim().toLowerCase();
        const gapInfo = currentGaps.find(gap => gap.id === gapId);
        
        if (!gapInfo) return;
        
        if (userAnswer === gapInfo.correctAnswer) {
          input.classList.add('correct');
          input.classList.remove('incorrect');
          correctCount++;
          results.push({
            id: gapId,
            correct: true,
            userAnswer: userAnswer,
            correctAnswer: gapInfo.correctAnswer
          });
        } else {
          input.classList.add('incorrect');
          input.classList.remove('correct');
          results.push({
            id: gapId,
            correct: false,
            userAnswer: userAnswer,
            correctAnswer: gapInfo.correctAnswer
          });
        }
      });
      
      // Display results
      const resultsDiv = document.getElementById('results');
      const scoreDisplay = document.getElementById('scoreDisplay');
      const detailedResults = document.getElementById('detailedResults');
      
      const percentage = Math.round((correctCount / currentGaps.length) * 100);
      scoreDisplay.textContent = `Score: ${correctCount}/${currentGaps.length} (${percentage}%)`;
      
      let detailedHTML = '<h4>Detailed Results:</h4><ul>';
      results.forEach(result => {
        if (result.correct) {
          detailedHTML += `<li>Gap ${result.id}: ‚úÖ Correct! You answered: "${result.userAnswer}"</li>`;
        } else {
          detailedHTML += `<li>Gap ${result.id}: ‚ùå Incorrect. You answered: "${result.userAnswer}". Correct answer: <span class="correct-answer">"${result.correctAnswer}"</span></li>`;
        }
      });
      detailedHTML += '</ul>';
      
      detailedResults.innerHTML = detailedHTML;
      resultsDiv.style.display = 'block';
      
      // Scroll to results
      resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function showAllAnswers() {
      gapInputs.forEach(input => {
        const gapId = parseInt(input.dataset.gapId);
        const gapInfo = currentGaps.find(gap => gap.id === gapId);
        
        if (gapInfo) {
          input.value = gapInfo.correctAnswer;
          input.classList.add('correct');
          input.classList.remove('incorrect');
        }
      });
      
      // Display perfect score
      const resultsDiv = document.getElementById('results');
      const scoreDisplay = document.getElementById('scoreDisplay');
      const detailedResults = document.getElementById('detailedResults');
      
      scoreDisplay.textContent = `All answers revealed! Perfect score: ${currentGaps.length}/${currentGaps.length} (100%)`;
      detailedResults.innerHTML = '<p>All correct answers have been filled in for you.</p>';
      resultsDiv.style.display = 'block';
    }

    // Initial generation
    generateGaps();
  </script>

</body>
</html>
