<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Audio Transcript Practice - University Policy Announcement</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.8;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      background-color: #fefefe;
    }
    h2 {
      color: #2a2a2a;
      border-bottom: 2px solid #0078d4;
      padding-bottom: 10px;
    }
    .transcript-container {
      margin-top: 30px;
      background-color: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }
    .gap {
      position: relative;
      border-bottom: 2px dotted #ff5500;
      cursor: pointer;
      color: transparent;
      text-shadow: 0 0 5px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
    .gap:hover {
      color: #2a2a2a;
      text-shadow: none;
      background-color: #fff9e6;
    }
    .gap::after {
      content: attr(data-word);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #2a2a2a;
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      white-space: nowrap;
      font-size: 14px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 10;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .gap:hover::after {
      opacity: 1;
    }
    button {
      margin-top: 20px;
      padding: 10px 15px;
      font-size: 16px;
      background-color: #0078d4;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #005fa3;
    }
    .instructions {
      background-color: #e8f4fc;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #0078d4;
      font-size: 14px;
    }
    .audio-container {
      margin: 20px 0;
      padding: 15px;
      background-color: #f0f7ff;
      border-radius: 8px;
      border: 1px solid #cce0ff;
    }
  </style>
</head>
<body>

  <h2>ðŸŽ§ Audio Transcript Practice: University Policy Announcement</h2>
  
  <div class="instructions">
    <p><strong>Instructions:</strong> Listen to the audio, then practice the transcript by hovering over the blank spaces (__________) to reveal the hidden words. Click the "ðŸ”„ New Gaps" button to generate a new set of hidden words for practice.</p>
  </div>

  <!-- Audio player from SoundCloud -->
  <div class="audio-container">
    <iframe width="100%" height="166" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/soundcloud%253Atracks%253A2251223072&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true"></iframe>
    <div style="font-size: 10px; color: #cccccc;line-break: anywhere;word-break: normal;overflow: hidden;white-space: nowrap;text-overflow: ellipsis; font-family: Interstate,Lucida Grande,Lucida Sans Unicode,Lucida Sans,Garuda,Verdana,Tahoma,sans-serif;font-weight: 100;">
      <a href="https://soundcloud.com/grzegorz-tarnowski-1" title="Grzegorz Tarnowski" target="_blank" style="color: #cccccc; text-decoration: none;">Grzegorz Tarnowski</a> Â· 
      <a href="https://soundcloud.com/grzegorz-tarnowski-1/amw01" title="AMW01" target="_blank" style="color: #cccccc; text-decoration: none;">AMW01</a>
    </div>
  </div>

  <div class="transcript-container">
    <h3>Transcript:</h3>
    <div id="transcript"></div>
    <button onclick="generateGaps()">ðŸ”„ New Gaps</button>
  </div>

  <script>
    const originalText = `
I have an announcement to make. I've just been reminded that State University has a policy that rule changes take effect as students are entering a program. Rules cannot be changed for students who are already part way through a program.

Since this is a university-wide policy, it countermands any decision that this department might make. When we change the requirements of the Sociology Department by adding two more required courses, students who were already in the department complained to the university. Because it is a university policy that rule changes can take effect only as students enter a program, the university decided that students who were already part way through their sociology programs could not be forced to follow the new requirements.

University policy mandates that the new requirements can take effect only with students who are newly entering the Sociology Department. And not with students who have already started the program. The end result is that students who have already started their sociology program cannot be forced to follow the new requirements.

They can graduate from this department with the three required courses and the five electives, instead of the five required courses and three electives. And, because the department can't force current students to take the two additional required courses, all we can do is make a strong recommendation to current students to take the courses instead of requiring them to do it. The new requirements will go into effect immediately for new students entering the department.
`;

    function generateGaps() {
      const container = document.getElementById('transcript');
      container.innerHTML = applyGaps(originalText.trim(), 0.4);
    }

    function applyGaps(text, density = 0.4) {
      const paragraphs = text.split('\n\n');
      let result = '';
      
      paragraphs.forEach(paragraph => {
        const words = paragraph.split(' ');
        const numGaps = Math.floor(words.length * density);
        const gapIndices = new Set();

        // Select random words to be gaps
        while (gapIndices.size < numGaps) {
          const i = Math.floor(Math.random() * words.length);
          const clean = words[i].replace(/[.,!?;:]/g, '');
          if (!words[i].includes('<span') && clean.length > 2) gapIndices.add(i);
        }

        // Process each word in the paragraph
        const processedParagraph = words.map((word, i) => {
          const clean = word.replace(/[.,!?;:]/g, '');
          const punctuation = word.match(/[.,!?;:]+$/);
          
          if (gapIndices.has(i)) {
            return `<span class="gap" data-word="${clean}">__________</span>${punctuation ? punctuation[0] : ''}`;
          }
          return word;
        }).join(' ');

        result += `<p>${processedParagraph}</p>`;
      });
      
      return result;
    }

    // Initial render
    generateGaps();
  </script>

</body>
</html>
