<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fill-in-the-Blank: Resilience and Versatility for Success</title>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      line-height: 1.6;
      padding: 15px;
      margin: 0;
      background-color: #f5f7fa;
      color: #333;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    
    h2 {
      color: #2a2a2a;
      border-bottom: 3px solid #28a745;
      padding-bottom: 12px;
      margin: 0 0 15px 0;
      font-size: 1.5rem;
      line-height: 1.3;
    }
    
    .writing-container {
      margin-top: 20px;
      background-color: white;
      padding: 20px 15px;
      border-radius: 12px;
      border: 1px solid #e1e5e9;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .gap-input {
      display: inline-block;
      min-width: 60px;
      margin: 2px;
      padding: 8px 10px;
      border: 2px solid #d1d9e6;
      border-radius: 6px;
      background-color: white;
      text-align: center;
      font-family: inherit;
      font-size: 16px;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
    
    .gap-input:focus {
      outline: none;
      border-color: #28a745;
      box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
    }
    
    .correct {
      border-color: #28a745;
      background-color: #f0fff4;
    }
    
    .incorrect {
      border-color: #dc3545;
      background-color: #fff0f0;
    }
    
    .correct-answer {
      color: #28a745;
      font-weight: bold;
    }
    
    .buttons-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 25px 0 15px 0;
    }
    
    button {
      flex: 1;
      min-width: 140px;
      padding: 14px 16px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }
    
    #checkAnswers {
      background-color: #28a745;
      color: white;
    }
    
    #checkAnswers:hover, #checkAnswers:active {
      background-color: #218838;
    }
    
    #showAnswers {
      background-color: #0078d4;
      color: white;
    }
    
    #showAnswers:hover, #showAnswers:active {
      background-color: #005fa3;
    }
    
    #resetGaps {
      background-color: #ff9800;
      color: white;
    }
    
    #resetGaps:hover, #resetGaps:active {
      background-color: #e68900;
    }
    
    .instructions {
      background-color: #e8f5e9;
      padding: 16px;
      border-radius: 10px;
      margin-bottom: 20px;
      border-left: 4px solid #28a745;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .results {
      margin-top: 20px;
      padding: 18px;
      border-radius: 10px;
      background-color: #f8f9fa;
      border: 1px solid #e0e0e0;
      display: none;
      font-size: 15px;
    }
    
    .score {
      font-size: 18px;
      font-weight: bold;
      color: #28a745;
      margin-bottom: 12px;
      text-align: center;
    }
    
    .gap-container {
      position: relative;
      display: inline-block;
      margin: 2px;
      vertical-align: middle;
    }
    
    .gap-number {
      position: absolute;
      top: -18px;
      left: 0;
      right: 0;
      font-size: 10px;
      color: #666;
      font-weight: bold;
      text-align: center;
      pointer-events: none;
    }
    
    .writing-content p {
      margin: 0 0 20px 0;
      font-size: 16px;
      line-height: 1.7;
      word-wrap: break-word;
    }
    
    .writing-content p:last-child {
      margin-bottom: 0;
    }
    
    .difficulty-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 15px 0;
      justify-content: center;
    }
    
    .difficulty-btn {
      padding: 8px 12px;
      background-color: #6c757d;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    
    .difficulty-btn:hover {
      background-color: #5a6268;
    }
    
    .difficulty-btn.active {
      background-color: #28a745;
    }
    
    /* Mobile-specific optimizations */
    @media (max-width: 768px) {
      body {
        padding: 12px;
      }
      
      h2 {
        font-size: 1.3rem;
        padding-bottom: 10px;
      }
      
      .writing-container {
        padding: 15px 12px;
      }
      
      .gap-input {
        min-width: 50px;
        padding: 6px 8px;
        font-size: 15px;
        margin: 1px;
      }
      
      .gap-number {
        font-size: 9px;
        top: -15px;
      }
      
      .writing-content p {
        font-size: 15px;
        line-height: 1.6;
      }
      
      button {
        min-width: 120px;
        padding: 12px 14px;
        font-size: 15px;
      }
      
      .instructions {
        padding: 14px;
        font-size: 13px;
      }
      
      .results {
        padding: 15px;
        font-size: 14px;
      }
      
      .difficulty-btn {
        padding: 6px 10px;
        font-size: 13px;
      }
    }
    
    @media (max-width: 480px) {
      .buttons-container {
        flex-direction: column;
        gap: 8px;
      }
      
      button {
        width: 100%;
        min-width: auto;
      }
      
      .gap-input {
        min-width: 40px;
        padding: 5px 6px;
        font-size: 14px;
      }
      
      .writing-content p {
        font-size: 14px;
        line-height: 1.5;
      }
      
      h2 {
        font-size: 1.2rem;
      }
      
      .container {
        padding: 0 8px;
      }
    }
    
    /* Touch-friendly improvements */
    .gap-input {
      min-height: 44px; /* Minimum touch target size */
    }
    
    button {
      min-height: 50px;
      touch-action: manipulation;
    }
    
    /* Improve readability on small screens */
    @media (max-width: 360px) {
      .gap-input {
        min-width: 35px;
        font-size: 13px;
        padding: 4px 5px;
        min-height: 40px;
      }
      
      .gap-number {
        font-size: 8px;
        top: -12px;
      }
      
      .writing-content p {
        font-size: 13px;
      }
    }
    
    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      body {
        background-color: #1a1a1a;
        color: #e0e0e0;
      }
      
      .writing-container {
        background-color: #2d2d2d;
        border-color: #404040;
      }
      
      .instructions {
        background-color: #1e3521;
        border-left-color: #28a745;
      }
      
      .results {
        background-color: #2d2d2d;
        border-color: #404040;
      }
      
      .gap-input {
        background-color: #3a3a3a;
        border-color: #555;
        color: #e0e0e0;
      }
      
      .gap-input::placeholder {
        color: #888;
      }
      
      .correct {
        background-color: #1e3a1e;
      }
      
      .incorrect {
        background-color: #3a1e1e;
      }
      
      .difficulty-btn {
        background-color: #495057;
      }
      
      .difficulty-btn:hover {
        background-color: #3d4348;
      }
      
      .difficulty-btn.active {
        background-color: #28a745;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>‚úçÔ∏è Fill-in-the-Blank: Resilience and Versatility for Success</h2>
    
    <div class="instructions">
      <p><strong>Instructions:</strong> Fill in the blanks with the correct words from the essay about resilience and versatility. Click "Check Answers" to validate your responses.</p>
      <p><em>Note: Answers are case-insensitive but must be spelled correctly. Punctuation is not required.</em></p>
      <div class="difficulty-options">
        <button class="difficulty-btn active" onclick="setDifficulty('easy')">Easy (30% gaps)</button>
        <button class="difficulty-btn" onclick="setDifficulty('medium')">Medium (45% gaps)</button>
        <button class="difficulty-btn" onclick="setDifficulty('hard')">Hard (60% gaps)</button>
      </div>
    </div>

    <div class="writing-container">
      <h3>Fill in the Blanks:</h3>
      <div id="writing" class="writing-content"></div>
      
      <div class="buttons-container">
        <button id="checkAnswers" onclick="checkAnswers()">‚úì Check Answers</button>
        <button id="showAnswers" onclick="showAllAnswers()">üëÅ Show Answers</button>
        <button id="resetGaps" onclick="generateGaps()">üîÑ New Gaps</button>
      </div>
      
      <div id="results" class="results">
        <div id="scoreDisplay" class="score"></div>
        <div id="detailedResults"></div>
      </div>
    </div>
  </div>

  <script>
    const originalText = `In my view, the most important characteristics for success are resilience and versatility.

First, resilience is key because the path to success is never smooth. You will face failures. A resilient person, like my father when his first business failed, learns from those mistakes and tries again with better knowledge. This ability to adapt and persist is fundamental.

Second, versatility is increasingly vital. The modern workplace changes fast. A versatile person who can handle different tasks‚Äîfrom physical work to office jobs‚Äîis incredibly valuable. They can seize new opportunities and aren't limited to one role.

Together, resilience helps you overcome obstacles, and versatility helps you navigate a changing world, making them a powerful combination for long-term success.`;

    let currentGaps = [];
    let gapInputs = [];
    let currentDifficulty = 'easy';
    const difficultySettings = {
      easy: 0.3,    // 30% gaps
      medium: 0.45, // 45% gaps
      hard: 0.6     // 60% gaps
    };

    function setDifficulty(level) {
      currentDifficulty = level;
      
      // Update active button
      document.querySelectorAll('.difficulty-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Regenerate gaps with new difficulty
      generateGaps();
    }

    function generateGaps() {
      const container = document.getElementById('writing');
      const paragraphs = originalText.trim().split('\n\n');
      const resultsDiv = document.getElementById('results');
      const scoreDisplay = document.getElementById('scoreDisplay');
      const detailedResults = document.getElementById('detailedResults');
      
      // Reset state
      currentGaps = [];
      gapInputs = [];
      resultsDiv.style.display = 'none';
      scoreDisplay.textContent = '';
      detailedResults.innerHTML = '';
      
      let htmlContent = '';
      let gapCounter = 1;
      
      paragraphs.forEach(paragraph => {
        const words = paragraph.split(' ');
        const numGaps = Math.floor(words.length * difficultySettings[currentDifficulty]);
        const gapIndices = new Set();

        // Select random words to be gaps
        while (gapIndices.size < numGaps) {
          const i = Math.floor(Math.random() * words.length);
          const clean = words[i].replace(/[.,!?‚Äî:]/g, '');
          
          // Skip short words, numbers, and special characters
          if (!words[i].includes('<') && clean.length > 2 && !/^\d+$/.test(clean)) {
            // For harder difficulties, include more common words
            if (currentDifficulty === 'hard' || 
                (currentDifficulty === 'medium' && clean.length > 3) ||
                (currentDifficulty === 'easy' && clean.length > 4)) {
              gapIndices.add(i);
            }
          }
        }

        // Process each word in the paragraph
        const processedWords = words.map((word, i) => {
          const clean = word.replace(/[.,!?‚Äî:]/g, '');
          const punctuation = word.match(/[.,!?‚Äî:]+$/);
          
          if (gapIndices.has(i)) {
            // Store gap information
            currentGaps.push({
              id: gapCounter,
              correctAnswer: clean.toLowerCase(),
              fullWord: word,
              position: gapCounter
            });
            
            const gapHtml = `
              <span class="gap-container">
                <span class="gap-number">${gapCounter}</span>
                <input type="text" 
                       class="gap-input" 
                       id="gap-${gapCounter}" 
                       data-gap-id="${gapCounter}"
                       placeholder="___"
                       style="width: ${Math.max(60, clean.length * 8)}px">
                ${punctuation ? punctuation[0] : ''}
              </span>
            `;
            gapCounter++;
            return gapHtml;
          }
          return word;
        });

        htmlContent += `<p>${processedWords.join(' ')}</p>`;
      });

      container.innerHTML = htmlContent;
      
      // Store references to all gap inputs
      gapInputs = Array.from(document.querySelectorAll('.gap-input'));
      
      // Add event listeners for Enter key and mobile optimization
      gapInputs.forEach(input => {
        // Enter key support
        input.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            checkAnswers();
          }
        });
        
        // Auto-resize input based on content
        input.addEventListener('input', function() {
          if (this.value.length > 0) {
            this.style.width = Math.max(60, this.value.length * 8) + 'px';
          }
        });
        
        // Mobile: prevent zoom on focus
        input.addEventListener('focus', function() {
          this.style.fontSize = '16px';
        });
      });
      
      // Add touch-friendly improvements
      document.addEventListener('touchstart', function() {}, {passive: true});
    }

    function checkAnswers() {
      let correctCount = 0;
      const results = [];
      
      gapInputs.forEach(input => {
        const gapId = parseInt(input.dataset.gapId);
        const userAnswer = input.value.trim().toLowerCase();
        const gapInfo = currentGaps.find(gap => gap.id === gapId);
        
        if (!gapInfo) return;
        
        // Check if answer is correct (allow for minor variations)
        let isCorrect = false;
        const correct = gapInfo.correctAnswer;
        
        // Basic exact match
        if (userAnswer === correct) {
          isCorrect = true;
        }
        // Allow singular/plural variations for some words
        else if ((correct.endsWith('s') && userAnswer === correct.slice(0, -1)) ||
                 (!correct.endsWith('s') && userAnswer === correct + 's')) {
          isCorrect = true;
        }
        
        if (isCorrect) {
          input.classList.add('correct');
          input.classList.remove('incorrect');
          correctCount++;
          results.push({
            id: gapId,
            correct: true,
            userAnswer: userAnswer,
            correctAnswer: correct
          });
        } else {
          input.classList.add('incorrect');
          input.classList.remove('correct');
          results.push({
            id: gapId,
            correct: false,
            userAnswer: userAnswer,
            correctAnswer: correct
          });
        }
      });
      
      // Display results
      const resultsDiv = document.getElementById('results');
      const scoreDisplay = document.getElementById('scoreDisplay');
      const detailedResults = document.getElementById('detailedResults');
      
      const percentage = Math.round((correctCount / currentGaps.length) * 100);
      scoreDisplay.textContent = `Score: ${correctCount}/${currentGaps.length} (${percentage}%)`;
      
      let detailedHTML = '<h4>Detailed Results:</h4><ul style="margin: 0; padding-left: 20px;">';
      results.forEach(result => {
        if (result.correct) {
          detailedHTML += `<li style="margin-bottom: 8px;">Gap ${result.id}: ‚úÖ Correct! You answered: "${result.userAnswer}"</li>`;
        } else {
          detailedHTML += `<li style="margin-bottom: 8px;">Gap ${result.id}: ‚ùå Incorrect. You answered: "${result.userAnswer}". Correct answer: <span class="correct-answer">"${result.correctAnswer}"</span></li>`;
        }
      });
      detailedHTML += '</ul>';
      
      detailedResults.innerHTML = detailedHTML;
      resultsDiv.style.display = 'block';
      
      // Scroll to results
      setTimeout(() => {
        resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }, 100);
    }

    function showAllAnswers() {
      gapInputs.forEach(input => {
        const gapId = parseInt(input.dataset.gapId);
        const gapInfo = currentGaps.find(gap => gap.id === gapId);
        
        if (gapInfo) {
          input.value = gapInfo.correctAnswer;
          input.style.width = Math.max(60, gapInfo.correctAnswer.length * 8) + 'px';
          input.classList.add('correct');
          input.classList.remove('incorrect');
        }
      });
      
      // Display perfect score
      const resultsDiv = document.getElementById('results');
      const scoreDisplay = document.getElementById('scoreDisplay');
      const detailedResults = document.getElementById('detailedResults');
      
      scoreDisplay.textContent = `All answers revealed! Perfect score: ${currentGaps.length}/${currentGaps.length} (100%)`;
      detailedResults.innerHTML = '<p>All correct answers have been filled in for you.</p>';
      resultsDiv.style.display = 'block';
      
      // Scroll to results
      setTimeout(() => {
        resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }, 100);
    }

    // Initial generation
    generateGaps();
    
    // Mobile: prevent double-tap zoom
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(event) {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        event.preventDefault();
      }
      lastTouchEnd = now;
    }, false);
  </script>
</body>
</html>
